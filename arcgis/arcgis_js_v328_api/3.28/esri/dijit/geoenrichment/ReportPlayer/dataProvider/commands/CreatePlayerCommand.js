// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.28/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePlayerCommand","require dojo/_base/declare esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/promise/all ../../PlayerCommands ../supportClasses/GEUtil dojo/i18n!esri/nls/jsapi".split(" "),function(n,p,q,e,r,t,u,d){function v(){var a=new q;n(["dijit/Dialog","esri/dijit/geoenrichment/utils/FileUtil","./mapToImage/MapToImageUtil","./supportClasses/HTMLPageBuilder"],function(b,d,c,g){f=b;k=
d;l=c;m=g;a.resolve()});return a.promise}d=d.geoenrichment.dijit.ReportPlayer.ReportPlayer;var f,k,l,m;return p(null,{id:t.DYNAMIC_HTML,label:d.createDynamicHTMLCommandLabel,errorMessage:d.exportInfographicError,execute:function(a,b){b=b||{};var d=this;return v().then(function(){var c=b.printableContainer,g=c.allowDataDrilling(),h;return r({mapImageInfos:l.collectMapsAsImages(a,{saveImagesAsDataUrl:!0}),comparisonTables:a._viewModel.loadAllStdFeatures()}).then(function(c){return e(a.reportDataToJson({allowDataDrilling:g,
mapImageInfos:c.mapImageInfos}),function(c){if(b.returnReportDataJson)h=c;else return e(function(c){var e=m.buildHTMLPageString(c,a,g);h=e;var f=a.getReportTitle()+".html";return e&&!b.returnAsHtmlText&&d._confirmSaveFile(f,function(){k.saveTextFile(e,f,"text/html")})}(c),function(){b.creditsTaskID&&u.consumeCredits(b.creditsTaskID)})})}).otherwise(this._handleError.bind(this)).always(function(){return e(c.stop(),function(){return h})})}.bind(this))},_handleError:function(a){console.log(a);(new f({title:"Error",
content:this.errorMessage})).show()},_confirmSaveFile:function(a,b){return b()}})});