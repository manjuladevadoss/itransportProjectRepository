// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.28/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/printing/_PrintSettingsSupport","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions esri/dijit/geoenrichment/ReportPlayer/PlayerCommands ./HeaderFooterSettingsBuilder ./PageSizeUtil".split(" "),function(m,g,k,e,n,h,p,q){return m(null,{_checkPrintSettings:function(a){function d(){var c=g.mixin({},a.exportSettings);delete c.pageSettings;
return g.mixin({commandId:a.commandId,noAutoScale:!b._checkNeedAutoScale(),pageSettings:g.mixin({},b.getCurrentReportContainer().documentOptions,a.exportSettings&&a.exportSettings.pageSettings),addHeader:!1,addDataSource:!1,addFooter:!1,reportTitle:void 0,reportSubtitle:void 0,allowDataDrilling:!0},c)}function r(){e(b._getPrintDialogSettings(a.commandId),function(a){var f=new b._player.printConfig.printDialogClass;f.onPrint=function(a){e(b._applyPrintSettings(g.mixin(d(),a)),c.resolve,c.reject)};
f.onCancel=function(){c.resolve("cancel")};f.show(a)})}var b=this,c=new k;a.showDialog?r():e(b._applyPrintSettings(d()),c.resolve,c.reject);return c.promise},getPrintDialogSettings:function(){return this._getPrintDialogSettings()},_getPrintDialogSettings:function(a){var d=this;return e(this._player.dataProvider.getCommands(),function(e){var b={canAutoScale:d._checkNeedAutoScale(),pageSettings:{pagesize:d.getCurrentReportContainer().documentOptions.pagesize,orientation:d.getCurrentReportContainer().documentOptions.orientation},
reportTitle:d._player.getReportTitle(),reportSubtitle:d._player.printConfig.subtitle,supportedPageSizes:q.getSupportedPageSizes().map(function(a){return{label:a.label,id:a.value}})};a&&(b.commandId=a);b.exportCommands=a?a===h.PRINT?null:e.filter(function(a){return a.id!==h.PRINT}):e;b.exportCommands&&(b.exportCommands=b.exportCommands.map(function(a){return{label:a.label,id:a.id}}));return b})},_checkNeedAutoScale:function(){return this.getAllReportContainers().some(function(a){return a.hasHiddenContent()})},
_applyPrintSettings:function(a){function d(){b.getAllReportContainers().forEach(function(a){a.resizeRowHeightToShowCellsContent()});var a=new k;setTimeout(a.resolve,500);return a.promise}function g(){return e(p.createHeaderFooterParams(b._player,b._viewModel,a),function(a){b._headerFooterParams=a})}var b=this;this._commandId=a.commandId||this._commandId;this._allowDataDrilling=a.allowDataDrilling;var c=a.commandId===h.DYNAMIC_HTML||a.noAutoScale,l,f;c||(l=this.getCurrentReportContainer().toJson());
f=this._player._showAllContainers();this._pageSettingsRollBackFunc=function(){f&&f.undo();f=null;if(!c)return b._player.updateTemplateJson(l),b._player.refresh({rerenderContent:!0})};return e(!c&&d(),function(){b._pageSettings=a.pageSettings;var c=n.getPageBox(a.pageSettings);b._pageFitParams={w:c.w,h:c.h,hAlign:"center",vAlign:"top"};return g()})}})});