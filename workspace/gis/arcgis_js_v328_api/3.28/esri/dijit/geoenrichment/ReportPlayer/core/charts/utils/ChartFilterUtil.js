// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.28/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartFilterUtil",["dojo/_base/lang","esri/dijit/geoenrichment/utils/ObjectUtil","./ChartTypes","./builder/utils/ChartDataUtil"],function(n,q,r,l){var h={collectStatsForVariables:function(c,e,g){var f=0,d={min:Infinity,max:-Infinity,decimals:0,dataArray:[]};c.forEach(function(a){a.points.forEach(function(a){a=l.getPointValue({point:a,viewModel:e,currentFeatureIndex:g});d.min=Math.min(d.min,a);d.max=Math.max(d.max,a);d.decimals=Math.max(d.decimals,
q.getPlaces(a));d.dataArray.push(a);f++})});return{filterRanges:[d],numVariablesTotal:f}},filterSeriesItems:function(c,e,g,f,d,a){return a?h._filterAreas(c,e,g,f):h._filterVariables(c,e,g,f,d)},_filterAreas:function(c,e,g,f){var d=0,a={};g.forEach(function(b){a[b.fieldName]=b});if(r.isLineLike(c))c=e.filter(function(b,c){return!b.points.some(function(b){var d=l.getPointValue({point:b,viewModel:f,currentFeatureIndex:c});b=a[b.fieldInfo.name];return d<b.min||d>b.max})}),d=c.length,c.length||(c.__firstSeriesItem=
e[0]);else{var k={};e.forEach(function(b){b.points.forEach(function(b,c){if(!k[c]){var d=l.getPointValue({point:b,viewModel:f,currentFeatureIndex:c});b=a[b.fieldInfo.name];if(d<b.min||d>b.max)k[c]=!0}})});c=e.map(function(b){b=n.mixin({},b);b.__firstPoint=b.points[0];b.points=b.points.filter(function(b,a){return!k[a]});d=b.points.length;return b})}return{seriesItems:c,numShownElements:d}},_filterVariables:function(c,e,g,f,d){var a,k=0,b=g[0];a=[];var h=1<e.length;e.forEach(function(c){seriesItemCopy=
n.mixin({},c);seriesItemCopy.points=[];c.points.forEach(function(a){var c=l.getPointValue({point:a,viewModel:f,currentFeatureIndex:d});c<b.min||c>b.max?h&&(a=n.mixin({},a),a.hidden=!0,seriesItemCopy.points.push(a)):seriesItemCopy.points.push(a)});h?a.push(seriesItemCopy):seriesItemCopy.points.length&&a.push(seriesItemCopy)});if(h){var p=0;a.forEach(function(a){p=Math.max(p,a.points.length)});for(var m=0;m<p;m++)a.every(function(a){a=a.points[m];return!a||a.hidden})&&a.forEach(function(a){if(a=a.points[m])a._toRemove=
!0});a=a.filter(function(a){a.points=a.points.filter(function(a){return!a._toRemove});return a.points.length})}a.forEach(function(a){a.points.forEach(function(a){a.hidden||k++})});return{seriesItems:a,numShownElements:k}},getFirstSeriesPoint:function(c){return c.__firstPoint},getFirstSeriesItem:function(c){return c.__firstSeriesItem}};return h});